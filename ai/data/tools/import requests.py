import requests
import json
from openai import OpenAI

def generate_data(prompt_template):
    headers = {"Authorization": "Bearer <sk-oZh7PkgH9keSz8S1Fc5cE21dD63f494eB5D01287Fc241c8d>"}
    data = {
        "model": "deepseek-r1",
        "messages": [{"role": "user", "content": prompt_template}],
        "temperature": 0.7
    }
    response = requests.post("https://maas-api.cn-huabei-1.xf-yun.com/v1", 
                           json=data, 
                           headers=headers)
    # æ£€æŸ¥å“åº”çŠ¶æ€ç 
    if response.status_code != 200:
        raise Exception(f"APIè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç ï¼š{response.status_code}")
    
    # æ‰“å°å®Œæ•´çš„å“åº”å†…å®¹
    response_json = response.json()
    print("APIå“åº”å†…å®¹ï¼š", response_json)
    
    # æ£€æŸ¥ 'choices' é”®æ˜¯å¦å­˜åœ¨
    if "choices" not in response_json:
        raise KeyError("'choices' é”®ä¸å­˜åœ¨äºå“åº”ä¸­")
    
    return response_json["choices"][0]["message"]["content"]


prompt_template = """ç”Ÿæˆå›¾ä¹¦é¦†æœåŠ¡å¯¹è¯éœ€ä¸¥æ ¼éµå¾ªä»¥ä¸‹è§„èŒƒï¼š
[åœºæ™¯è¦†ç›–]
1. å¿…é¡»è¦†ç›–ä»¥ä¸‹è‡³å°‘ä¸€ä¸ªæ ¸å¿ƒåœºæ™¯ï¼š
   - å›¾ä¹¦æ¨èï¼ˆéœ€åŒ…å«3-5æœ¬ç›¸å…³ä¹¦ç±ï¼Œæ³¨æ˜æ¨èç†ç”±ï¼‰
   - ç§¯åˆ†è§„åˆ™å’¨è¯¢ï¼ˆåŠ åˆ†/å‡åˆ†å…·ä½“æ¡æ¬¾ï¼‰
   - è¿è§„å¤„ç†å’¨è¯¢ï¼ˆé€¾æœŸ/æŸå/å åº§ç­‰åæœï¼‰
   - èµ„æºé¢„çº¦ï¼ˆåº§ä½/å‚¨ç‰©æŸœè§„åˆ™ï¼‰

[æ¡æ¬¾åµŒå…¥è§„èŒƒ]
2. æ¡æ¬¾å¼•ç”¨è¦æ±‚ï¼š
   â€¢ ç§¯åˆ†è§„åˆ™ï¼š
     â¢ åŠ åˆ†é¡¹ï¼š
       - å€Ÿé˜…å›¾ä¹¦ [æ¡æ¬¾1.1]
       - æäº¤åŸåˆ›ä¹¦è¯„(300å­—+) [æ¡æ¬¾1.3]
       - å‚åŠ æ´»åŠ¨/è¯¾ç¨‹ [æ¡æ¬¾1.4/1.5]
     â¢ å‡åˆ†é¡¹ï¼š
       - é€¾æœŸ(æ¯å¤©æ¯å†Œ-5åˆ†) [æ¡æ¬¾2.1+æ–‡æ¡£2.III]
       - æ±¡æŸå›¾ä¹¦(æœ€é«˜æŒ‰10å€èµ”å¿) [æ¡æ¬¾2.2+æ–‡æ¡£2.IV]
       - å åº§è¿çº¦ [æ¡æ¬¾2.4]

   â€¢ å¤–å€Ÿè§„åˆ™ï¼š
     â¢ å€Ÿé˜…æƒé™ï¼šæ•™èŒå·¥/å­¦ç”Ÿå¯å€Ÿ30å†Œ/60å¤© [æ¡æ¬¾3.2]
     â¢ ç»­å€Ÿè§„åˆ™ï¼šå¯ç»­å€Ÿ2æ¬¡(éœ€åœ¨åˆ°æœŸå‰åŠç†) [æ¡æ¬¾4.2]
     â¢ ç‰¹æ®Šè§„å®šï¼šç‰¹è—/å¤–æ–‡ä¹¦ä¸å¤–å€Ÿ [æ¡æ¬¾3.4]

[ç”Ÿæˆè§„èŒƒ]
3. å›å¤è¦æ±‚ï¼š
   - è‡ªç„¶èå…¥2-3ä¸ªç›¸å…³æ¡æ¬¾ï¼ˆæ¯ä¸ªæ¡æ¬¾å•ç‹¬æ ‡æ³¨ï¼‰
   - ä½¿ç”¨ç¬¦å·åˆ†éš”å†…å®¹ï¼š
     ğŸ“š ä¹¦ç±æ¨èéƒ¨åˆ†
     âš ï¸ é£é™©æç¤ºéƒ¨åˆ†
     ğŸ’¡ è§„åˆ™è¯´æ˜éƒ¨åˆ†
   - å¼•ç”¨æ ¼å¼ï¼š[æ¡æ¬¾ç¼–å·](@ref) åŒ…å«æ–‡æ¡£åºå·ï¼ˆä¾‹ï¼š[1.3]æŒ‡æ–‡æ¡£1ç¬¬3æ¡ï¼‰
   - é‡è¦æ•°å€¼éœ€ç²¾ç¡®ï¼ˆå¦‚é€¾æœŸæ¯å¤©æ‰£5åˆ†ï¼‰

[åˆè§„æ ¡éªŒ]
4. å¿…é¡»è§„é¿ï¼š
   - ä¸æ–‡æ¡£å†²çªçš„è¡¨è¿°ï¼ˆå¦‚å¤–æ–‡ä¹¦å¯å¤–å€Ÿï¼‰
   - é”™è¯¯èµ”å¿æ ‡å‡†ï¼ˆéœ€æŒ‰å‡ºç‰ˆå¹´ä»½åŒºåˆ†å€æ•°ï¼‰
   - è¿‡æ—¶çš„ç»­å€Ÿè§„åˆ™ï¼ˆ2022ä¿®è®¢ç‰ˆå…è®¸çº¿ä¸Šç»­å€Ÿï¼‰

ç¤ºä¾‹ï¼š
{"messages": [
  {"role": "user", "content": "ä¸å°å¿ƒæŠŠå’–å•¡æ´’åœ¨ä¹¦ä¸Šäº†æ€ä¹ˆåŠï¼Ÿ"},
  {"role": "assistant", "content": "âš ï¸ å›¾ä¹¦æ±¡æŸå¤„ç†æµç¨‹ï¼š
1. è¯·ç«‹å³åˆ°æœåŠ¡å°ç™»è®°æƒ…å†µ
2. æ ¹æ®æ±¡æŸç¨‹åº¦å¤„ç†ï¼š
   - è½»åº¦æ±¡æŸï¼ˆå¦‚é¡µé¢æ°´æ¸ï¼‰ï¼šæŒ‰ä¹¦ä»·50%èµ”å¿ [2.2.1](@ref)
   - ä¸¥é‡æ±¡æŸï¼ˆå½±å“é˜…è¯»ï¼‰ï¼šæŒ‰é—å¤±è§„åˆ™èµ”å¿ [2.2.2](@ref)
   - æŸåç£æ¡/æ¡ç ï¼šéœ€é¢å¤–æ”¯ä»˜åŠ å·¥è´¹ [2.2.3](@ref)
ğŸ’¡ æ¸©é¦¨æç¤ºï¼šå¤–å€Ÿæ—¶è¯·æ£€æŸ¥å›¾ä¹¦çŠ¶æ€ï¼Œå‘ç°é—®é¢˜åŠæ—¶æŠ¥å¤‡å¯å…é™¤è´£ä»» [3.3](@ref)"}
]}

{"messages": [
  {"role": "user", "content": "æ¯•ä¸šå‰éœ€è¦åšä»€ä¹ˆå‡†å¤‡ï¼Ÿ"},
  {"role": "assistant", "content": "æ¯•ä¸šç”Ÿç¦»æ ¡é¡»çŸ¥ï¼š
1. å½’è¿˜æ‰€æœ‰å¤–å€Ÿå›¾ä¹¦ï¼ˆå«ç»­å€Ÿä¸­çš„ï¼‰[4.4](@ref)
2. ç»“æ¸…é€¾æœŸè´¹ç”¨/èµ”å¿é‡‘ [æ–‡æ¡£2.IV]
3. å‚¨ç‰©æŸœéœ€åœ¨ç¦»æ ¡å‰æ¸…ç©º
4. ç§¯åˆ†å¯ç”¨äºæ¯•ä¸šå­£å…‘æ¢æ´»åŠ¨ [æ¡æ¬¾1.12]
ğŸ’¡ ç³»ç»Ÿå°†åœ¨ç¦»æ ¡å‰3å¤©å‘é€å‚¬è¿˜æé†’ [5](@ref)"}
]}

{"messages": [
  {"role": "user", "content": "æ¨èäººå·¥æ™ºèƒ½å…¥é—¨ä¹¦ç±"},
  {"role": "assistant", "content": "ğŸ“š äººå·¥æ™ºèƒ½ä¹¦å•æ¨èï¼š
1.ã€Šäººå·¥æ™ºèƒ½ï¼šç°ä»£æ–¹æ³•ã€‹- Stuart Russell
   - ç»å…¸æ•™æï¼Œæ¶µç›–æœºå™¨å­¦ä¹ åˆ°ä¼¦ç†é—®é¢˜
2.ã€ŠPythonæ·±åº¦å­¦ä¹ ã€‹- FranÃ§ois Chollet 
   - Kerasæ¡†æ¶å®æˆ˜æŒ‡å—ï¼Œé€‚åˆåˆå­¦è€…
3.ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ã€‹- Peter Harrington
   - ç»“åˆç®—æ³•ç†è®ºä¸ä»£ç å®è·µ

ğŸ’¡ å€Ÿé˜…å°è´´å£«ï¼š
- æ¯äººå¯åŒæ—¶å¤–å€Ÿ30å†Œ [3.2](@ref)
- å¤–æ–‡ä¹¦éœ€é¦†å†…é˜…è§ˆ [3.4](@ref)
- æ’°å†™300å­—ä¹¦è¯„å¯è·ç§¯åˆ† [1.3](@ref)"}
]}"""

# æ–°å¢çš„ä¿å­˜JSONåŠŸèƒ½å‡½æ•°
def save_to_json(data, filename='library_dialogs.json'):
    """
    å°†ç”Ÿæˆçš„å¯¹è¯æ•°æ®ä¿å­˜ä¸ºJSONæ–‡ä»¶
    
    å‚æ•°ï¼š
    data: str - åŒ…å«å¤šä¸ªJSONå¯¹è±¡çš„å­—ç¬¦ä¸²
    filename: str - è¾“å‡ºæ–‡ä»¶åï¼ˆé»˜è®¤ï¼šlibrary_dialogs.jsonï¼‰
    """
    try:
        # åˆ†å‰²å¹¶è§£æç”Ÿæˆçš„JSONå¯¹è±¡
        dialogues = [json.loads(obj) for obj in data.strip().split('\n') if obj]
        
        # å†™å…¥JSONæ–‡ä»¶
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(dialogues, f, 
                     ensure_ascii=False,  # ä¿ç•™ä¸­æ–‡
                     indent=4,           # æ ¼å¼åŒ–ç¼©è¿›
                     separators=(',', ': '))  # ä¼˜åŒ–åˆ†éš”ç¬¦
            
        print(f"âœ… æ•°æ®å·²ä¿å­˜è‡³ {filename}")
        print(f"ğŸ“‚ æ–‡ä»¶è·¯å¾„ï¼š{os.path.abspath(filename)}")
        
    except json.JSONDecodeError as e:
        print(f"âŒ JSONè§£æå¤±è´¥ï¼š{e}")
    except Exception as e:
        print(f"âŒ æ–‡ä»¶ä¿å­˜å¼‚å¸¸ï¼š{e}")

# åœ¨åŸæœ‰ä»£ç åæ·»åŠ è°ƒç”¨
generated_data = generate_data(prompt_template)
save_to_json(generated_data)  # æ–°å¢è¿™è¡Œä¿å­˜æ“ä½œ